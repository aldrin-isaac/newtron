name: bgp-underlay
description: Verify eBGP underlay sessions establish across 4-node fabric
topology: 4node

steps:
  - name: provision-all
    action: provision
    devices: all

  - name: wait-convergence
    action: wait
    duration: 30s

  - name: verify-provisioning
    action: verify-provisioning
    devices: all

  - name: verify-bgp-sessions
    action: verify-bgp
    devices: all
    expect:
      state: Established
      timeout: 120s
      poll_interval: 5s

  - name: verify-leaf1-loopback-at-spine1
    action: verify-route
    devices: [spine1]
    prefix: "10.0.0.11/32"
    vrf: default
    expect:
      protocol: bgp
      nexthop_ip: "10.1.0.1"
      source: app_db
      timeout: 60s
