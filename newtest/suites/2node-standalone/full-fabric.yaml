name: full-fabric
description: Full fabric test â€” provision, BGP, services, health, and connectivity
topology: 4node
platform: sonic-vpp

steps:
  - name: provision-all
    action: provision
    devices: all

  - name: wait-convergence
    action: wait
    duration: 45s

  - name: verify-provisioning
    action: verify-provisioning
    devices: all

  - name: verify-bgp-sessions
    action: verify-bgp
    devices: all
    expect:
      state: Established
      timeout: 120s
      poll_interval: 5s

  - name: apply-customer-l3-leaf1
    action: apply-service
    devices: [leaf1]
    interface: Ethernet2
    service: customer-l3
    params:
      ip: "192.168.1.1/24"

  - name: apply-server-irb-leaf2
    action: apply-service
    devices: [leaf2]
    interface: Ethernet2
    service: server-irb

  - name: verify-health
    action: verify-health
    devices: all
    expect:
      overall: ok

  - name: verify-ping-leaf1-to-leaf2
    action: verify-ping
    devices: [leaf1]
    target: "10.0.0.12"
    count: 5
    expect:
      success_rate: 1.0
      timeout: 30s
