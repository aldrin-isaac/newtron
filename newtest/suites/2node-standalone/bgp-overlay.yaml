name: bgp-overlay
description: Verify EVPN overlay routes propagate between leaves via spines
topology: 4node

steps:
  - name: provision-all
    action: provision
    devices: all

  - name: wait-convergence
    action: wait
    duration: 30s

  - name: verify-bgp-sessions
    action: verify-bgp
    devices: all
    expect:
      state: Established
      timeout: 120s
      poll_interval: 5s

  - name: verify-leaf1-loopback-at-leaf2
    action: verify-route
    devices: [leaf2]
    prefix: "10.0.0.11/32"
    vrf: default
    expect:
      protocol: bgp
      source: app_db
      timeout: 60s

  - name: verify-health
    action: verify-health
    devices: all
    expect:
      overall: ok
