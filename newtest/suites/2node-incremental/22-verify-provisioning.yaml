name: verify-provisioning
description: Apply a service, then verify the ChangeSet was persisted in CONFIG_DB
topology: 2node
requires: [refresh-service]

steps:
  # Apply customer-l3 service â€” this produces a ChangeSet
  - name: apply-customer-l3
    action: apply-service
    devices: [leaf1]
    interface: Ethernet1
    service: customer-l3
    params:
      ip: "192.168.1.1/24"

  # Verify the ChangeSet was persisted correctly
  - name: verify-changeset
    action: verify-provisioning
    devices: [leaf1]

  # Clean up: remove the service
  - name: cleanup-remove
    action: remove-service
    devices: [leaf1]
    interface: Ethernet1

  # Verify cleanup
  - name: verify-cleanup
    action: verify-config-db
    devices: [leaf1]
    table: NEWTRON_SERVICE_BINDING
    key: Ethernet1
    expect:
      exists: false
