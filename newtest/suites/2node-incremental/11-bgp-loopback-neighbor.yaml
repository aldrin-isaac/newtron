name: bgp-loopback-neighbor
description: "Add and remove a loopback-based BGP neighbor via newtron API"
topology: 2node
requires: [provision]

steps:
  - name: add-loopback-neighbor
    action: bgp-add-neighbor
    devices: [switch2]
    params:
      neighbor_ip: "10.0.0.99"
      remote_asn: 65099

  - name: verify-neighbor-exists
    action: verify-config-db
    devices: [switch2]
    table: BGP_NEIGHBOR
    key: "default|10.0.0.99"
    expect:
      exists: true

  - name: remove-loopback-neighbor
    action: bgp-remove-neighbor
    devices: [switch2]
    params:
      neighbor_ip: "10.0.0.99"

  - name: verify-neighbor-removed
    action: verify-config-db
    devices: [switch2]
    table: BGP_NEIGHBOR
    key: "default|10.0.0.99"
    expect:
      exists: false
