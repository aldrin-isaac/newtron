name: interface-set
description: Test interface property changes via newtron set-interface API
topology: 2node
requires: [provision]

steps:
  - name: set-mtu-9000
    action: set-interface
    devices: [switch2]
    interface: Ethernet1
    params:
      property: mtu
      value: "9000"

  - name: verify-mtu-9000
    action: verify-config-db
    devices: [switch2]
    table: PORT
    key: Ethernet1
    expect:
      fields:
        mtu: "9000"

  - name: set-description
    action: set-interface
    devices: [switch2]
    interface: Ethernet1
    params:
      property: description
      value: "test-link"

  - name: verify-description
    action: verify-config-db
    devices: [switch2]
    table: PORT
    key: Ethernet1
    expect:
      fields:
        description: "test-link"

  - name: set-admin-down
    action: set-interface
    devices: [switch2]
    interface: Ethernet1
    params:
      property: admin_status
      value: down

  - name: verify-admin-down
    action: verify-config-db
    devices: [switch2]
    table: PORT
    key: Ethernet1
    expect:
      fields:
        admin_status: down

  # Dataplane: admin-down must propagate to kernel oper_status
  - name: verify-oper-down
    action: verify-state-db
    devices: [switch2]
    table: PORT_TABLE
    key: Ethernet1
    expect:
      fields:
        netdev_oper_status: down
      timeout: 15s
      poll_interval: 2s

  - name: set-admin-up
    action: set-interface
    devices: [switch2]
    interface: Ethernet1
    params:
      property: admin_status
      value: up

  - name: verify-admin-up
    action: verify-config-db
    devices: [switch2]
    table: PORT
    key: Ethernet1
    expect:
      fields:
        admin_status: up

  # Dataplane: admin-up must restore kernel oper_status
  - name: verify-oper-up
    action: verify-state-db
    devices: [switch2]
    table: PORT_TABLE
    key: Ethernet1
    expect:
      fields:
        netdev_oper_status: up
      timeout: 15s
      poll_interval: 2s

  # Restore default MTU
  - name: restore-mtu
    action: set-interface
    devices: [switch2]
    interface: Ethernet1
    params:
      property: mtu
      value: "9100"
