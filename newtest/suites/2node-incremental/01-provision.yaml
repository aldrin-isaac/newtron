name: provision
description: Provision all devices and verify CONFIG_DB state
topology: 2node
platform: sonic-vpp
requires: [boot-ssh]

steps:
  - name: provision-all
    action: provision
    devices: all

  - name: verify-provisioning
    action: verify-provisioning
    devices: all

  - name: verify-device-metadata-spine1
    action: verify-config-db
    devices: [spine1]
    table: DEVICE_METADATA
    key: localhost
    expect:
      exists: true

  - name: verify-device-metadata-leaf1
    action: verify-config-db
    devices: [leaf1]
    table: DEVICE_METADATA
    key: localhost
    expect:
      exists: true

  - name: verify-loopback-spine1
    action: verify-config-db
    devices: [spine1]
    table: LOOPBACK_INTERFACE
    expect:
      min_entries: 1

  - name: verify-loopback-leaf1
    action: verify-config-db
    devices: [leaf1]
    table: LOOPBACK_INTERFACE
    expect:
      min_entries: 1
