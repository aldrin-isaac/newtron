name: teardown-bgp-overlay
description: Remove loopback-to-loopback overlay BGP neighbors from both switches
topology: 2node
requires: [teardown-evpn]

steps:
  # Overlay peer IPs: switch1 removes switch2's loopback, switch2 removes switch1's.
  # bgp-remove-neighbor also cleans up all BGP_NEIGHBOR_AF entries (ipv4/ipv6/l2vpn_evpn).
  - name: remove-overlay-peer-switch1
    action: bgp-remove-neighbor
    devices: [switch1]
    params:
      neighbor_ip: "10.0.0.2"

  - name: remove-overlay-peer-switch2
    action: bgp-remove-neighbor
    devices: [switch2]
    params:
      neighbor_ip: "10.0.0.1"

  - name: verify-overlay-peer-removed-switch1
    action: verify-config-db
    devices: [switch1]
    table: BGP_NEIGHBOR
    key: "default|10.0.0.2"
    expect:
      exists: false

  - name: verify-overlay-peer-removed-switch2
    action: verify-config-db
    devices: [switch2]
    table: BGP_NEIGHBOR
    key: "default|10.0.0.1"
    expect:
      exists: false
