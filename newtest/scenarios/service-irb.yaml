name: service-irb
description: Apply server-irb service on two leaves, verify VXLAN and VRF config
topology: 4node
platform: sonic-vpp

steps:
  - name: provision-all
    action: provision
    devices: all

  - name: wait-config-apply
    action: wait
    duration: 30s

  - name: apply-server-irb-leaf1
    action: apply-service
    devices: [leaf1]
    interface: Ethernet2
    service: server-irb

  - name: apply-server-irb-leaf2
    action: apply-service
    devices: [leaf2]
    interface: Ethernet2
    service: server-irb

  - name: verify-vxlan-tunnel
    action: verify-config-db
    devices: [leaf1]
    table: VXLAN_TUNNEL
    expect:
      min_entries: 1

  - name: verify-vrf
    action: verify-config-db
    devices: [leaf1]
    table: VRF
    expect:
      min_entries: 1

  - name: verify-health
    action: verify-health
    devices: all
    expect:
      overall: ok
