name: service-l3
description: Apply and remove customer-l3 service, verify CONFIG_DB state
topology: 2node
platform: sonic-vpp

steps:
  - name: provision-all
    action: provision
    devices: all

  - name: wait-config-apply
    action: wait
    duration: 30s

  - name: apply-customer-l3
    action: apply-service
    devices: [leaf1]
    interface: Ethernet1
    service: customer-l3
    params:
      ip: "192.168.1.1/24"

  - name: verify-service-binding
    action: verify-config-db
    devices: [leaf1]
    table: NEWTRON_SERVICE_BINDING
    key: "Ethernet1"
    expect:
      fields:
        service: customer-l3

  - name: remove-customer-l3
    action: remove-service
    devices: [leaf1]
    interface: Ethernet1

  - name: verify-service-removed
    action: verify-config-db
    devices: [leaf1]
    table: NEWTRON_SERVICE_BINDING
    key: "Ethernet1"
    expect:
      exists: false
